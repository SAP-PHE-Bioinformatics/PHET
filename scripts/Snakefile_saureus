## CONFIGFILE

configfile: "phet.yaml"

if config["saureus"]:
    rule all:
        input:
            directory(expand("PHET/Staphylococcus_aureus/sccmec/{sample}", sample=config["saureus"])),
            "PHET/Staphylococcus_aureus/Summary_sccmec.tab"


if config["saureus"]:
    rule sccmec:
        input:
            "filtered_contigs/{sample}.fna"
        output:
            outdir = directory("PHET/Staphylococcus_aureus/sccmec/{sample}"),
            out_tsv = "PHET/Staphylococcus_aureus/sccmec/{sample}/{sample}.tsv"
    
        conda:
            "sccmec"
        params:
            seqid = '{sample}'
        shell:
            "sccmec --input {input} --prefix {params.seqid} --outdir {output.outdir}"



if config["saureus"]:
    rule sccmec_sum:
        input:
            files = expand(rules.sccmec.output.out_tsv, sample=config["saureus"])
        output:
            "PHET/Staphylococcus_aureus/Summary_sccmec.tab"
        run:
            import pandas as pd
            dfs = []
            # sfiles = f"{input.files}".split()
            for file in input.files:
                df = pd.read_csv(file, sep='\t')
                dfs.append(df)
            summary_table = pd.concat(dfs)
            summary_table.to_csv(output[0], sep='\t', index=False)
